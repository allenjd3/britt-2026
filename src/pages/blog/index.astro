---
import type { GetPostsQuery } from "../../graphql/generated";
import query from "../../get-posts.graphql?raw";
import { graphqlFetch } from "../../lib/graphqlFetch";
import MainLayout from "../../layouts/MainLayout.astro";

const first = 5;

const data = await graphqlFetch<GetPostsQuery>(query, {
  first,
});

const posts = data.posts?.nodes ?? [];
const nextCursor = data.posts?.pageInfo.endCursor;
const hasNext = data.posts?.pageInfo.hasNextPage ?? false;

const nextPageUrl = hasNext ? `/blog/page/${nextCursor}` : null;
---
<MainLayout title="Blog">
    <h1>Posts</h1>

    <ul>
      {posts.map((post) => (
        <li>
          <a href={post.uri}>{post.title ?? "Untitled"}</a>
        </li>
      ))}
    </ul>

    {nextPageUrl && (
      <a href={nextPageUrl}>
        <button>Next Page</button>
      </a>
    )}
</MainLayout>