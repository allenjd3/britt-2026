---
import type { GetPostsQuery } from "../../../graphql/generated";
import query from "../../../get-posts.graphql?raw";
import { graphqlFetch } from "../../../lib/graphqlFetch";

const {after} = Astro.params;

const first = 5;

const data = await graphqlFetch<GetPostsQuery>(query, {
  first,
  after,
});

const posts = data.posts?.nodes ?? [];
const nextCursor = data.posts?.pageInfo.endCursor;
const hasNext = data.posts?.pageInfo.hasNextPage ?? false;

const nextPageUrl = hasNext ? `/blog/page/${nextCursor}` : null;
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Paginated Posts</title>
  </head>
  <body>
    <h1>Posts</h1>

    <ul>
      {posts.map((post) => (
        <li>
          <a href={post.uri}>{post.title ?? "Untitled"}</a>
        </li>
      ))}
    </ul>

    {nextPageUrl && (
      <a href={nextPageUrl}>
        <button>Next Page</button>
      </a>
    )}
  </body>
</html>